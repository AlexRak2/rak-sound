<Window x:Class="SonnissBrowser.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:sonnissBrowser="clr-namespace:SonnissBrowser"
        xmlns:local="clr-namespace:SonnissBrowser"
        xmlns:shell="http://schemas.microsoft.com/winfx/2006/xaml/presentation/shell"
        Title="RakSound"
        Width="1500" Height="860"
        WindowStartupLocation="CenterScreen"
        Background="{DynamicResource Bg0}"
        WindowStyle="None"
        ResizeMode="CanResize"
        AllowsTransparency="False"
        Icon="Assets/app.ico"
        Loaded="Window_Loaded"
        StateChanged="Window_StateChanged"
        PreviewKeyDown="Window_PreviewKeyDown">

    <Window.Resources>

        <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter"/>
        <local:FavoriteStarConverter x:Key="FavoriteStarConverter"/>
        <local:FavoriteColorConverter x:Key="FavoriteColorConverter"/>
        <local:SortHeaderConverter x:Key="SortHeaderConverter"/>

        <!-- =========================================================
             THEME BRUSHES (your code-behind / theme swapper should override these keys)
             ========================================================= -->

        <!-- Core surfaces -->
        <SolidColorBrush x:Key="Bg0" Color="#1E1E1E"/>
        <SolidColorBrush x:Key="Bg1" Color="#252526"/>
        <SolidColorBrush x:Key="Bg2" Color="#2D2D30"/>
        <SolidColorBrush x:Key="Panel" Color="#252526"/>
        <SolidColorBrush x:Key="Border" Color="#333337"/>

        <!-- Caption buttons (themeable) -->
        <SolidColorBrush x:Key="CaptionBtnFg" Color="#DDDDDD"/>
        <SolidColorBrush x:Key="CaptionBtnHoverBg" Color="#2A2A2A"/>
        <SolidColorBrush x:Key="CaptionBtnPressedBg" Color="#3A3A3A"/>

        <SolidColorBrush x:Key="CaptionBtnCloseHoverBg" Color="#C42B1C"/>
        <SolidColorBrush x:Key="CaptionBtnClosePressedBg" Color="#A52317"/>
        <SolidColorBrush x:Key="CaptionBtnCloseFg" Color="White"/>

        
        <!-- Inputs -->
        <SolidColorBrush x:Key="InputBg" Color="#3C3C3C"/>
        <SolidColorBrush x:Key="InputBorder" Color="#555555"/>
        <SolidColorBrush x:Key="InputFg" Color="#CCCCCC"/>

        <!-- Text -->
        <SolidColorBrush x:Key="Text0" Color="#CCCCCC"/>
        <SolidColorBrush x:Key="Text1" Color="#BBBBBB"/>
        <SolidColorBrush x:Key="Text2" Color="#858585"/>
        <SolidColorBrush x:Key="Text3" Color="#6A6A6A"/>

        <!-- Header -->
        <SolidColorBrush x:Key="HeaderBg" Color="#323233"/>
        <SolidColorBrush x:Key="HeaderFg" Color="#858585"/>

        <!-- Accent -->
        <SolidColorBrush x:Key="Accent" Color="#0E639C"/>
        <SolidColorBrush x:Key="AccentBright" Color="#007ACC"/>
        <SolidColorBrush x:Key="Selection" Color="#094771"/>

        <!-- Title bar -->
        <SolidColorBrush x:Key="TitleBar" Color="#111111"/>
        <SolidColorBrush x:Key="TitleBarBorder" Color="#2A2A2A"/>

        <!-- Buttons -->
        <SolidColorBrush x:Key="BtnBg" Color="#3F3F46"/>
        <SolidColorBrush x:Key="BtnBorder" Color="#555555"/>
        <SolidColorBrush x:Key="BtnFg" Color="#CCCCCC"/>
        <SolidColorBrush x:Key="BtnBgHover" Color="#505055"/>
        <SolidColorBrush x:Key="BtnBgPressed" Color="#5A5A5F"/>

        <!-- Bottom transport buttons (always readable) -->
        <SolidColorBrush x:Key="BottomBtnBg" Color="#2B2B2B"/>
        <SolidColorBrush x:Key="BottomBtnBgHover" Color="#3A3A3A"/>
        <SolidColorBrush x:Key="BottomBtnBgPressed" Color="#444444"/>
        <SolidColorBrush x:Key="BottomBtnFg" Color="#FFFFFF"/>

        <!-- Waveform (IMPORTANT for light mode!) -->
        <SolidColorBrush x:Key="WaveBg" Color="#1B1B1C"/>
        <SolidColorBrush x:Key="WaveBorder" Color="#333337"/>
        <SolidColorBrush x:Key="WaveAccent" Color="#007ACC"/>
        <SolidColorBrush x:Key="WaveSelection" Color="#094771"/>

        <SolidColorBrush x:Key="HoverBg" Color="#2A2D2E"/>

        <!-- =========================================================
             ScrollBars (unchanged)
             ========================================================= -->
        <Style TargetType="{x:Type ScrollBar}">
            <Setter Property="Width" Value="6"/>
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="{x:Type ScrollBar}">
                        <Grid Background="Transparent">
                            <Track x:Name="PART_Track" IsDirectionReversed="False">
                                <Track.DecreaseRepeatButton>
                                    <RepeatButton Command="ScrollBar.LineUpCommand" Opacity="0" IsHitTestVisible="False"/>
                                </Track.DecreaseRepeatButton>
                                <Track.Thumb>
                                    <Thumb Background="#3E3E42" Opacity="0.4">
                                        <Thumb.Template>
                                            <ControlTemplate TargetType="Thumb">
                                                <Border x:Name="ThumbBorder"
                                                        CornerRadius="3"
                                                        Background="{TemplateBinding Background}"
                                                        Margin="1"/>
                                                <ControlTemplate.Triggers>
                                                    <Trigger Property="IsMouseOver" Value="True">
                                                        <Setter TargetName="ThumbBorder" Property="Background" Value="#686868"/>
                                                        <Setter TargetName="ThumbBorder" Property="Opacity" Value="0.7"/>
                                                    </Trigger>
                                                </ControlTemplate.Triggers>
                                            </ControlTemplate>
                                        </Thumb.Template>
                                    </Thumb>
                                </Track.Thumb>
                                <Track.IncreaseRepeatButton>
                                    <RepeatButton Command="ScrollBar.LineDownCommand" Opacity="0" IsHitTestVisible="False"/>
                                </Track.IncreaseRepeatButton>
                            </Track>
                        </Grid>

                        <ControlTemplate.Triggers>
                            <Trigger Property="Orientation" Value="Horizontal">
                                <Setter Property="Height" Value="6"/>
                                <Setter Property="Width" Value="Auto"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- =========================================================
             Buttons
             ========================================================= -->
        <Style TargetType="Button" x:Key="Btn">
            <Setter Property="Background" Value="{DynamicResource BtnBg}"/>
            <Setter Property="Foreground" Value="{DynamicResource BtnFg}"/>
            <Setter Property="BorderBrush" Value="{DynamicResource BtnBorder}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding" Value="14,7"/> <!-- ✅ more padding -->
            <Setter Property="MinHeight" Value="30"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="FontSize" Value="11"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="border"
                                CornerRadius="3"
                                Background="{TemplateBinding Background}"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}">
                            <ContentPresenter
                                HorizontalAlignment="Center"
                                VerticalAlignment="Center"
                                Margin="{TemplateBinding Padding}"/>

                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="border" Property="Background" Value="{DynamicResource BtnBgHover}"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter TargetName="border" Property="Background" Value="{DynamicResource BtnBgPressed}"/>
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter Property="Opacity" Value="0.4"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style TargetType="Button" x:Key="BtnAccent" BasedOn="{StaticResource Btn}">
            <Setter Property="Background" Value="{DynamicResource AccentBright}"/>
            <Setter Property="BorderBrush" Value="{DynamicResource AccentBright}"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderThickness" Value="0"/>
        </Style>

        <!-- ✅ Bottom bar buttons: always white text + proper padding -->
        <Style TargetType="Button" x:Key="BottomBtn" BasedOn="{StaticResource Btn}">
            <Setter Property="Background" Value="{DynamicResource BottomBtnBg}"/>
            <Setter Property="BorderBrush" Value="{DynamicResource BottomBtnBg}"/>
            <Setter Property="Foreground" Value="{DynamicResource BottomBtnFg}"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="16,8"/>
            <Setter Property="MinHeight" Value="30"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="border"
                                CornerRadius="4"
                                Background="{TemplateBinding Background}">
                            <ContentPresenter
                                HorizontalAlignment="Center"
                                VerticalAlignment="Center"
                                Margin="{TemplateBinding Padding}"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="border" Property="Background" Value="{DynamicResource BottomBtnBgHover}"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter TargetName="border" Property="Background" Value="{DynamicResource BottomBtnBgPressed}"/>
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter Property="Opacity" Value="0.35"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- =========================================================
             TextBox
             ========================================================= -->
        <Style TargetType="TextBox" x:Key="SearchBox">
            <Setter Property="Background" Value="{DynamicResource InputBg}"/>
            <Setter Property="Foreground" Value="{DynamicResource InputFg}"/>
            <Setter Property="BorderBrush" Value="{DynamicResource InputBorder}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding" Value="10,5"/>
            <Setter Property="Height" Value="30"/>
            <Setter Property="FontSize" Value="11"/>
            <Setter Property="VerticalContentAlignment" Value="Center"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="TextBox">
                        <Border x:Name="border"
                                Background="{TemplateBinding Background}"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}"
                                CornerRadius="3">
                            <ScrollViewer x:Name="PART_ContentHost"
                                          Margin="2"
                                          VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="border" Property="BorderBrush" Value="#6A6A6A"/>
                            </Trigger>
                            <Trigger Property="IsFocused" Value="True">
                                <Setter TargetName="border" Property="BorderBrush" Value="{DynamicResource AccentBright}"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- =========================================================
             ListView / ListViewItem
             ========================================================= -->
        <Style TargetType="ListView" x:Key="List">
            <Setter Property="Background" Value="{DynamicResource Bg1}"/>
            <Setter Property="Foreground" Value="{DynamicResource Text0}"/>
            <Setter Property="BorderBrush" Value="Transparent"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="0"/>
            <Setter Property="FontSize" Value="11"/>
        </Style>

        <!-- NOTE: Use default GridViewRowPresenter binding (do NOT TemplateBind GridView.ColumnCollection) -->
        <Style TargetType="ListViewItem">
            <Setter Property="Padding" Value="10,4"/>
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
            <Setter Property="Height" Value="22"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ListViewItem">
                        <Border x:Name="Bd"
                                Background="{TemplateBinding Background}"
                                BorderThickness="0"
                                Padding="{TemplateBinding Padding}">
                            <GridViewRowPresenter Content="{TemplateBinding Content}"
                                                  VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="Bd" Property="Background" Value="{DynamicResource HoverBg}"/>
                            </Trigger>
                            <Trigger Property="IsSelected" Value="True">
                                <Setter TargetName="Bd" Property="Background" Value="{DynamicResource Selection}"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- =========================================================
             GridViewColumnHeader (scoped via ListView.Resources below)
             ========================================================= -->

        <!-- =========================================================
             TreeView (unchanged from your working one)
             ========================================================= -->
        <Style TargetType="TreeView">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="{DynamicResource Text0}"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="0"/>
            <Setter Property="FontSize" Value="11"/>
        </Style>

        <Style TargetType="TreeViewItem">
            <Setter Property="Foreground" Value="{DynamicResource Text1}"/>
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Padding" Value="6,3"/>
            <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="TreeViewItem">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>

                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="18"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>

                            <ToggleButton x:Name="Expander"
                                          Grid.Row="0"
                                          Grid.Column="0"
                                          Width="14"
                                          Height="14"
                                          Margin="2,3,2,0"
                                          IsChecked="{Binding IsExpanded, RelativeSource={RelativeSource TemplatedParent}}"
                                          ClickMode="Press"
                                          Focusable="False"
                                          Background="Transparent"
                                          BorderThickness="0"
                                          HorizontalAlignment="Center"
                                          VerticalAlignment="Center">
                                <Border x:Name="ExpanderBox"
                                        Width="14"
                                        Height="14"
                                        Background="#3E3E42"
                                        CornerRadius="2">
                                    <TextBlock x:Name="Glyph"
                                               Text="+"
                                               FontSize="12"
                                               Foreground="{DynamicResource Text0}"
                                               HorizontalAlignment="Center"
                                               VerticalAlignment="Center"
                                               Margin="0,-1,0,0"/>
                                </Border>
                            </ToggleButton>

                            <Border x:Name="Bd"
                                    Grid.Row="0"
                                    Grid.Column="1"
                                    Background="{TemplateBinding Background}"
                                    Padding="{TemplateBinding Padding}">
                                <ContentPresenter x:Name="PART_Header"
                                                  ContentSource="Header"
                                                  HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}"
                                                  VerticalAlignment="Center"/>
                            </Border>

                            <ItemsPresenter x:Name="ItemsHost"
                                            Grid.Row="1"
                                            Grid.Column="1"
                                            Margin="18,0,0,0"/>
                        </Grid>

                        <ControlTemplate.Triggers>
                            <Trigger Property="IsExpanded" Value="False">
                                <Setter TargetName="ItemsHost" Property="Visibility" Value="Collapsed"/>
                            </Trigger>

                            <Trigger Property="IsExpanded" Value="True">
                                <Setter TargetName="Glyph" Property="Text" Value="−"/>
                            </Trigger>

                            <Trigger Property="HasItems" Value="False">
                                <Setter TargetName="Expander" Property="Visibility" Value="Hidden"/>
                            </Trigger>

                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="Bd" Property="Background" Value="{DynamicResource HoverBg}"/>
                            </Trigger>

                            <Trigger Property="IsSelected" Value="True">
                                <Setter TargetName="Bd" Property="Background" Value="{DynamicResource Selection}"/>
                                <Setter Property="Foreground" Value="{DynamicResource Text0}"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- =========================================================
             Sliders (unchanged)
             ========================================================= -->
        <Style TargetType="Slider" x:Key="Timeline">
            <Setter Property="Height" Value="20"/>
            <Setter Property="Margin" Value="8,0"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Slider">
                        <Grid>
                            <Border Height="3"
                                    Background="#3E3E42"
                                    CornerRadius="1.5"
                                    VerticalAlignment="Center"/>
                            <Track x:Name="PART_Track">
                                <Track.DecreaseRepeatButton>
                                    <RepeatButton Command="Slider.DecreaseLarge">
                                        <RepeatButton.Template>
                                            <ControlTemplate TargetType="RepeatButton">
                                                <Border Height="3"
                                                        Background="{DynamicResource AccentBright}"
                                                        CornerRadius="1.5,0,0,1.5"/>
                                            </ControlTemplate>
                                        </RepeatButton.Template>
                                    </RepeatButton>
                                </Track.DecreaseRepeatButton>
                                <Track.Thumb>
                                    <Thumb Width="12" Height="12">
                                        <Thumb.Template>
                                            <ControlTemplate>
                                                <Ellipse x:Name="ThumbEllipse"
                                                         Fill="{DynamicResource AccentBright}"/>
                                                <ControlTemplate.Triggers>
                                                    <Trigger Property="IsMouseOver" Value="True">
                                                        <Setter TargetName="ThumbEllipse" Property="Fill" Value="#1C97EA"/>
                                                    </Trigger>
                                                </ControlTemplate.Triggers>
                                            </ControlTemplate>
                                        </Thumb.Template>
                                    </Thumb>
                                </Track.Thumb>
                                <Track.IncreaseRepeatButton>
                                    <RepeatButton Command="Slider.IncreaseLarge">
                                        <RepeatButton.Template>
                                            <ControlTemplate TargetType="RepeatButton">
                                                <Border Background="Transparent"/>
                                            </ControlTemplate>
                                        </RepeatButton.Template>
                                    </RepeatButton>
                                </Track.IncreaseRepeatButton>
                            </Track>
                        </Grid>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style TargetType="Slider" x:Key="VolumeSlider">
            <Setter Property="Height" Value="20"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Slider">
                        <Grid>
                            <Border Height="3"
                                    Background="#3E3E42"
                                    CornerRadius="1.5"
                                    VerticalAlignment="Center"/>
                            <Track x:Name="PART_Track">
                                <Track.DecreaseRepeatButton>
                                    <RepeatButton Command="Slider.DecreaseLarge">
                                        <RepeatButton.Template>
                                            <ControlTemplate TargetType="RepeatButton">
                                                <Border Height="3"
                                                        Background="{DynamicResource AccentBright}"
                                                        CornerRadius="1.5,0,0,1.5"/>
                                            </ControlTemplate>
                                        </RepeatButton.Template>
                                    </RepeatButton>
                                </Track.DecreaseRepeatButton>
                                <Track.Thumb>
                                    <Thumb Width="10" Height="10">
                                        <Thumb.Template>
                                            <ControlTemplate>
                                                <Ellipse Fill="{DynamicResource AccentBright}"/>
                                            </ControlTemplate>
                                        </Thumb.Template>
                                    </Thumb>
                                </Track.Thumb>
                                <Track.IncreaseRepeatButton>
                                    <RepeatButton Command="Slider.IncreaseLarge">
                                        <RepeatButton.Template>
                                            <ControlTemplate TargetType="RepeatButton">
                                                <Border Background="Transparent"/>
                                            </ControlTemplate>
                                        </RepeatButton.Template>
                                    </RepeatButton>
                                </Track.IncreaseRepeatButton>
                            </Track>
                        </Grid>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Caption buttons (unchanged) -->
        <Style x:Key="CaptionBtn" TargetType="Button">
            <Setter Property="Width" Value="46"/>
            <Setter Property="Height" Value="32"/>
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="{DynamicResource CaptionBtnFg}"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="FontSize" Value="12"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="bd" Background="{TemplateBinding Background}">
                            <!-- ✅ THIS is the missing piece -->
                            <ContentPresenter
                                HorizontalAlignment="Center"
                                VerticalAlignment="Center"
                                TextElement.Foreground="{TemplateBinding Foreground}"/>
                        </Border>

                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="bd" Property="Background" Value="{DynamicResource CaptionBtnHoverBg}"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter TargetName="bd" Property="Background" Value="{DynamicResource CaptionBtnPressedBg}"/>
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter Property="Opacity" Value="0.5"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="CaptionBtnClose" TargetType="Button" BasedOn="{StaticResource CaptionBtn}">
            <Setter Property="Foreground" Value="{DynamicResource CaptionBtnCloseFg}"/>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="{DynamicResource CaptionBtnCloseHoverBg}"/>
                </Trigger>
                <Trigger Property="IsPressed" Value="True">
                    <Setter Property="Background" Value="{DynamicResource CaptionBtnClosePressedBg}"/>
                </Trigger>
            </Style.Triggers>
        </Style>


    </Window.Resources>

    <WindowChrome.WindowChrome>
        <WindowChrome CaptionHeight="32"
                      CornerRadius="0"
                      GlassFrameThickness="0"
                      ResizeBorderThickness="6"
                      UseAeroCaptionButtons="False"/>
    </WindowChrome.WindowChrome>

    <!-- ✅ IMPORTANT: parent Grid so overlay can sit on top -->
    <Grid Background="{DynamicResource Bg0}">

        <!-- ===================== MAIN UI ===================== -->
        <DockPanel LastChildFill="True">

            <!-- CUSTOM TITLE BAR -->
            <Border DockPanel.Dock="Top"
                    Height="32"
                    Background="{DynamicResource TitleBar}"
                    BorderBrush="{DynamicResource TitleBarBorder}"
                    BorderThickness="0,0,0,1">

                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <Border Grid.Column="0"
                            Background="Transparent"
                            MouseLeftButtonDown="TitleBar_MouseLeftButtonDown"
                            WindowChrome.IsHitTestVisibleInChrome="True">
                        <StackPanel Orientation="Horizontal"
                                    Margin="10,0,0,0"
                                    VerticalAlignment="Center">

                            <Image Width="16"
                                   Height="16"
                                   Margin="0,0,8,0"
                                   Source="Assets/app.ico"
                                   SnapsToDevicePixels="True"/>

                            <TextBlock Text="RakSound"
                                       VerticalAlignment="Center"
                                       Foreground="{DynamicResource Text0}"
                                       FontSize="12"
                                       FontWeight="SemiBold"/>
                        </StackPanel>
                    </Border>

                    <StackPanel Grid.Column="1"
                                Orientation="Horizontal"
                                WindowChrome.IsHitTestVisibleInChrome="True">

                        <Button Style="{StaticResource CaptionBtn}"
                                Content="—"
                                Click="Minimize_Click">
                            <WindowChrome.IsHitTestVisibleInChrome>True</WindowChrome.IsHitTestVisibleInChrome>
                        </Button>

                        <Button Style="{StaticResource CaptionBtn}"
                                Content="▢"
                                Click="MaxRestore_Click"
                                WindowChrome.IsHitTestVisibleInChrome="True"/>

                        <Button Style="{StaticResource CaptionBtnClose}"
                                Content="✕"
                                Click="Close_Click"
                                WindowChrome.IsHitTestVisibleInChrome="True"/>
                    </StackPanel>
                </Grid>
            </Border>

            <!-- TOP BAR -->
            <Border DockPanel.Dock="Top"
                    Background="{DynamicResource Bg1}"
                    BorderBrush="{DynamicResource Border}"
                    BorderThickness="0,0,0,1"
                    Padding="12,8">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="240"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                        <Image Width="18"
                               Height="18"
                               Margin="0,0,8,0"
                               Source="Assets/app.ico"
                               SnapsToDevicePixels="True"/>

                        <TextBlock Text="RakSound"
                                   Foreground="{DynamicResource Text0}"
                                   FontSize="13"
                                   FontWeight="SemiBold"/>
                    </StackPanel>

                    <TextBox Grid.Column="1"
                             Style="{StaticResource SearchBox}"
                             Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}"
                             Margin="12,0"
                             ToolTip="Search"/>

                    <!-- ✅ Choose Folder padded -->
                    <Button Grid.Column="2"
                            Style="{StaticResource BtnAccent}"
                            Content="Choose Folder"
                            Command="{Binding ChooseFolderCommand}"
                            Padding="18,8"
                            MinHeight="32"
                            Margin="0,0,8,0"/>

                    <Button x:Name="ThemeToggleBtn"
                            Grid.Column="3"
                            Style="{StaticResource Btn}"
                            Content="{Binding ThemeIcon}"
                            Command="{Binding ToggleThemeCommand}"
                            ToolTip="Toggle Dark/Light Mode"
                            Width="40"
                            Padding="0"
                            FontSize="14"
                            Margin="0,0,8,0"/>

                    <TextBlock Grid.Column="4"
                               Text="{Binding StatusText}"
                               Foreground="{DynamicResource Text2}"
                               FontSize="10"
                               VerticalAlignment="Center"/>
                </Grid>
            </Border>

            <!-- ===================== BOTTOM TRANSPORT BAR ===================== -->
            <Border DockPanel.Dock="Bottom"
                    Background="{DynamicResource Bg1}"
                    BorderBrush="{DynamicResource Border}"
                    BorderThickness="0,1,0,0"
                    Padding="12,10">

                <Grid Height="64">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                        <!-- ✅ white text buttons -->
                        <Button Style="{StaticResource BottomBtn}"
                                Width="90"
                                Content="{Binding PlayButtonText}"
                                Command="{Binding PlaySelectedCommand}"/>

                        <Button Style="{StaticResource BottomBtn}"
                                Width="70"
                                Margin="10,0,0,0"
                                Content="Stop"
                                Command="{Binding StopCommand}"/>
                    </StackPanel>

                    <Grid Grid.Column="1" Margin="16,0" VerticalAlignment="Center">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="6"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <DockPanel Grid.Row="0" LastChildFill="False">
                            <TextBlock Text="{Binding NowPlayingTitle}"
                                       Foreground="{DynamicResource Text0}"
                                       FontSize="11"
                                       TextTrimming="CharacterEllipsis"/>

                            <TextBlock Text="  •  "
                                       Foreground="{DynamicResource Text3}"
                                       FontSize="11"
                                       Margin="6,0"/>

                            <TextBlock Text="{Binding NowPlayingSubtitle}"
                                       Foreground="{DynamicResource Text2}"
                                       FontSize="11"
                                       TextTrimming="CharacterEllipsis"/>
                        </DockPanel>

                        <Grid Grid.Row="2">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="70"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="70"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>

                            <TextBlock Text="{Binding ElapsedText}"
                                       Foreground="{DynamicResource Text2}"
                                       FontSize="10"
                                       VerticalAlignment="Center"
                                       HorizontalAlignment="Left"/>

                            <Slider Grid.Column="1"
                                    Style="{StaticResource Timeline}"
                                    Minimum="0"
                                    Maximum="{Binding DurationSeconds}"
                                    Value="{Binding PositionSeconds, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                    IsEnabled="{Binding HasMedia}"
                                    PreviewMouseLeftButtonDown="Timeline_MouseDown"
                                    PreviewMouseLeftButtonUp="Timeline_MouseUp"/>

                            <TextBlock Grid.Column="2"
                                       Text="{Binding DurationText}"
                                       Foreground="{DynamicResource Text2}"
                                       FontSize="10"
                                       VerticalAlignment="Center"
                                       HorizontalAlignment="Right"/>

                            <!-- ✅ padding fix -->
                            <Button Grid.Column="3"
                                    Style="{StaticResource BottomBtn}"
                                    Content="Set Export Folder"
                                    Padding="18,8"
                                    Margin="10,0,0,0"
                                    Command="{Binding ChooseExportFolderCommand}"/>

                            <Button Grid.Column="4"
                                    Style="{StaticResource BottomBtn}"
                                    Content="Export"
                                    Padding="18,8"
                                    Margin="10,0,0,0"
                                    Command="{Binding ExportSelectionCommand}"
                                    IsEnabled="{Binding HasSelection}"/>

                            <Button Grid.Column="5"
                                    Style="{StaticResource BottomBtn}"
                                    Content="Clear"
                                    Padding="18,8"
                                    Margin="10,0,0,0"
                                    Command="{Binding ClearSelectionCommand}"
                                    IsEnabled="{Binding HasSelection}"/>
                        </Grid>
                    </Grid>

                    <StackPanel Grid.Column="2"
                                Orientation="Horizontal"
                                VerticalAlignment="Center"
                                Margin="16,0,0,0">
                        <TextBlock Text="Vol"
                                   Foreground="{DynamicResource Text2}"
                                   VerticalAlignment="Center"
                                   FontSize="10"
                                   Margin="0,0,8,0"/>
                        <Slider Style="{StaticResource VolumeSlider}"
                                Minimum="0"
                                Maximum="1"
                                Value="{Binding Volume, Mode=TwoWay}"
                                Width="110"/>
                    </StackPanel>
                </Grid>
            </Border>

            <!-- ===================== WAVEFORM STRIP ===================== -->
            <Border DockPanel.Dock="Bottom"
                    Background="{DynamicResource Bg1}"
                    BorderBrush="{DynamicResource Border}"
                    BorderThickness="0,1,0,0"
                    Padding="12,10">

                <!-- ✅ Light mode fix: bind waveform brushes to theme keys -->
                <sonnissBrowser:WaveformControl
                    Peaks="{Binding WavePeaks}"
                    DurationSeconds="{Binding DurationSeconds}"
                    PositionSeconds="{Binding PositionSeconds}"
                    SelectionStartSeconds="{Binding SelectionStartSeconds}"
                    SelectionEndSeconds="{Binding SelectionEndSeconds}"
                    FadeInSeconds="{Binding Effects.FadeInSeconds}"
                    FadeOutSeconds="{Binding Effects.FadeOutSeconds}"
                    AccentBrush="{DynamicResource WaveAccent}"
                    SelectionBrush="{DynamicResource WaveSelection}"
                    BackgroundBrush="{DynamicResource WaveBg}"
                    BorderBrush="{DynamicResource WaveBorder}"
                    BorderThickness="1"
                    CornerRadius="3"
                    Height="70"
                    PreviewMouseLeftButtonDown="Wave_MouseDown"
                    PreviewMouseMove="Wave_MouseMove"
                    PreviewMouseLeftButtonUp="Wave_MouseUp"/>
            </Border>

            <!-- ===================== MAIN CONTENT AREA ===================== -->
            <Grid Margin="0">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="240"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="320"/>
                </Grid.ColumnDefinitions>

                <!-- LEFT PANEL -->
                <Border Grid.Column="0"
                        Background="{DynamicResource Panel}"
                        BorderBrush="{DynamicResource Border}"
                        BorderThickness="0,0,1,0"
                        Padding="8">
                    <DockPanel>
                        <TextBlock DockPanel.Dock="Top"
                                   Text="LIBRARIES"
                                   Foreground="{DynamicResource Text3}"
                                   FontSize="9"
                                   FontWeight="SemiBold"
                                   Margin="6,4,0,8"/>

                        <TreeView ItemsSource="{Binding CategoryTree}"
                                  SelectedItemChanged="CategoryTree_SelectedItemChanged">
                            <TreeView.ItemTemplate>
                                <HierarchicalDataTemplate ItemsSource="{Binding Children}">
                                    <TextBlock Text="{Binding DisplayName}"/>
                                </HierarchicalDataTemplate>
                            </TreeView.ItemTemplate>
                        </TreeView>
                    </DockPanel>
                </Border>

                <!-- MIDDLE PANEL -->
                <Border Grid.Column="1"
                        Background="{DynamicResource Bg1}"
                        BorderBrush="{DynamicResource Border}"
                        BorderThickness="0,0,1,0">

                    <ListView Style="{StaticResource List}"
                              ItemsSource="{Binding SoundsView}"
                              SelectedItem="{Binding Selected}"
                              SelectionMode="Extended"
                              local:ListViewSelectedItemsBehavior.SelectedItems="{Binding SelectedItems}"
                              MouseDoubleClick="ListView_MouseDoubleClick"
                              GridViewColumnHeader.Click="GridViewColumnHeader_Click">

                        <!-- ✅ Header style scoped to this ListView -->
                        <ListView.Resources>
                            <Style TargetType="{x:Type GridViewColumnHeader}">
                                <Setter Property="Background" Value="{DynamicResource HeaderBg}"/>
                                <Setter Property="Foreground" Value="{DynamicResource HeaderFg}"/>
                                <Setter Property="BorderBrush" Value="#3F3F46"/>
                                <Setter Property="BorderThickness" Value="0,0,1,1"/>
                                <Setter Property="Padding" Value="10,5"/>
                                <Setter Property="FontSize" Value="10"/>
                                <Setter Property="Height" Value="24"/>
                                <Setter Property="Cursor" Value="Hand"/>

                                <Setter Property="Template">
                                    <Setter.Value>
                                        <ControlTemplate TargetType="{x:Type GridViewColumnHeader}">
                                            <Border x:Name="HeaderBorder"
                                                    Background="{TemplateBinding Background}"
                                                    BorderBrush="{TemplateBinding BorderBrush}"
                                                    BorderThickness="{TemplateBinding BorderThickness}"
                                                    Padding="{TemplateBinding Padding}">
                                                <ContentPresenter x:Name="HeaderContent"
                                                                  ContentSource="Content"
                                                                  HorizontalAlignment="Left"
                                                                  VerticalAlignment="Center"/>
                                            </Border>

                                            <ControlTemplate.Triggers>
                                                <Trigger Property="IsMouseOver" Value="True">
                                                    <Setter TargetName="HeaderBorder" Property="Background" Value="#3A3A3D"/>
                                                </Trigger>

                                                <Trigger Property="IsPressed" Value="True">
                                                    <Setter TargetName="HeaderBorder" Property="Background" Value="#404045"/>
                                                </Trigger>

                                                <!-- ✅ padding header: safe -->
                                                <Trigger Property="Role" Value="Padding">
                                                    <Setter Property="Cursor" Value="Arrow"/>
                                                    <Setter TargetName="HeaderBorder" Property="Background" Value="{DynamicResource HeaderBg}"/>
                                                    <Setter TargetName="HeaderBorder" Property="BorderThickness" Value="0,0,0,1"/>
                                                    <Setter TargetName="HeaderContent" Property="Visibility" Value="Collapsed"/>
                                                    <Setter Property="Padding" Value="0"/>
                                                </Trigger>
                                            </ControlTemplate.Triggers>
                                        </ControlTemplate>
                                    </Setter.Value>
                                </Setter>
                            </Style>
                        </ListView.Resources>

                        <ListView.View>
                            <GridView>
                                <!-- Favorite -->
                                <GridViewColumn Width="32">
                                    <GridViewColumn.HeaderTemplate>
                                        <DataTemplate>
                                            <TextBlock Foreground="{DynamicResource HeaderFg}">
                                                <TextBlock.Text>
                                                    <MultiBinding Converter="{StaticResource SortHeaderConverter}" ConverterParameter="★">
                                                        <Binding Path="DataContext.SortColumn" RelativeSource="{RelativeSource AncestorType=ListView}"/>
                                                        <Binding Path="DataContext.SortDirection" RelativeSource="{RelativeSource AncestorType=ListView}"/>
                                                    </MultiBinding>
                                                </TextBlock.Text>
                                            </TextBlock>
                                        </DataTemplate>
                                    </GridViewColumn.HeaderTemplate>

                                    <GridViewColumn.CellTemplate>
                                        <DataTemplate>
                                            <Button Content="{Binding IsFavorite, Converter={StaticResource FavoriteStarConverter}}"
                                                    Command="{Binding DataContext.ToggleFavoriteCommand, RelativeSource={RelativeSource AncestorType=ListView}}"
                                                    CommandParameter="{Binding}"
                                                    Background="Transparent"
                                                    BorderThickness="0"
                                                    Foreground="{Binding IsFavorite, Converter={StaticResource FavoriteColorConverter}}"
                                                    FontSize="14"
                                                    Padding="0"
                                                    Margin="-8,0,0,0"
                                                    Cursor="Hand"
                                                    ToolTip="Toggle favorite">
                                                <Button.Template>
                                                    <ControlTemplate TargetType="Button">
                                                        <Border Background="Transparent">
                                                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                                        </Border>
                                                    </ControlTemplate>
                                                </Button.Template>
                                            </Button>
                                        </DataTemplate>
                                    </GridViewColumn.CellTemplate>
                                </GridViewColumn>

                                <!-- Name -->
                                <GridViewColumn Width="688" DisplayMemberBinding="{Binding FileName}">
                                    <GridViewColumn.HeaderTemplate>
                                        <DataTemplate>
                                            <TextBlock Foreground="{DynamicResource HeaderFg}">
                                                <TextBlock.Text>
                                                    <MultiBinding Converter="{StaticResource SortHeaderConverter}" ConverterParameter="Name">
                                                        <Binding Path="DataContext.SortColumn" RelativeSource="{RelativeSource AncestorType=ListView}"/>
                                                        <Binding Path="DataContext.SortDirection" RelativeSource="{RelativeSource AncestorType=ListView}"/>
                                                    </MultiBinding>
                                                </TextBlock.Text>
                                            </TextBlock>
                                        </DataTemplate>
                                    </GridViewColumn.HeaderTemplate>
                                </GridViewColumn>

                                <!-- Category -->
                                <GridViewColumn Width="260" DisplayMemberBinding="{Binding EffectiveCategory}">
                                    <GridViewColumn.HeaderTemplate>
                                        <DataTemplate>
                                            <TextBlock Foreground="{DynamicResource HeaderFg}">
                                                <TextBlock.Text>
                                                    <MultiBinding Converter="{StaticResource SortHeaderConverter}" ConverterParameter="Category">
                                                        <Binding Path="DataContext.SortColumn" RelativeSource="{RelativeSource AncestorType=ListView}"/>
                                                        <Binding Path="DataContext.SortDirection" RelativeSource="{RelativeSource AncestorType=ListView}"/>
                                                    </MultiBinding>
                                                </TextBlock.Text>
                                            </TextBlock>
                                        </DataTemplate>
                                    </GridViewColumn.HeaderTemplate>
                                </GridViewColumn>

                                <!-- Library -->
                                <GridViewColumn Width="260" DisplayMemberBinding="{Binding Category}">
                                    <GridViewColumn.HeaderTemplate>
                                        <DataTemplate>
                                            <TextBlock Foreground="{DynamicResource HeaderFg}">
                                                <TextBlock.Text>
                                                    <MultiBinding Converter="{StaticResource SortHeaderConverter}" ConverterParameter="Library">
                                                        <Binding Path="DataContext.SortColumn" RelativeSource="{RelativeSource AncestorType=ListView}"/>
                                                        <Binding Path="DataContext.SortDirection" RelativeSource="{RelativeSource AncestorType=ListView}"/>
                                                    </MultiBinding>
                                                </TextBlock.Text>
                                            </TextBlock>
                                        </DataTemplate>
                                    </GridViewColumn.HeaderTemplate>
                                </GridViewColumn>
                            </GridView>
                        </ListView.View>
                    </ListView>
                </Border>

                <!-- RIGHT PANEL -->
                <Border Grid.Column="2"
                        Background="{DynamicResource Panel}"
                        BorderBrush="{DynamicResource Border}"
                        BorderThickness="1,0,0,0"
                        Padding="10">

                    <DockPanel>
                        <TextBlock DockPanel.Dock="Top"
                                   Text="DETAILS"
                                   Foreground="{DynamicResource Text3}"
                                   FontSize="9"
                                   FontWeight="SemiBold"
                                   Margin="6,4,0,8"/>

                        <ScrollViewer VerticalScrollBarVisibility="Auto">
                            <StackPanel>

                                <TextBlock Text="{Binding Selected.FileName}"
                                           Foreground="{DynamicResource Text0}"
                                           FontSize="12"
                                           FontWeight="SemiBold"
                                           TextWrapping="Wrap"/>

                                <TextBlock Text="{Binding Selected.FullPath}"
                                           Foreground="{DynamicResource Text2}"
                                           FontSize="10"
                                           Margin="0,4,0,12"
                                           TextWrapping="Wrap"/>

                                <TextBlock Text="Category"
                                           Foreground="{DynamicResource Text3}"
                                           FontSize="10"
                                           Margin="0,0,0,4"/>

                                <ComboBox ItemsSource="{Binding CategoryOptions}"
                                          Text="{Binding Selected.ManualCategory, UpdateSourceTrigger=PropertyChanged}"
                                          IsEditable="True"
                                          Height="28"
                                          Background="#3C3C3C"
                                          Foreground="{DynamicResource Text0}"
                                          BorderBrush="#555555"
                                          BorderThickness="1"
                                          Padding="6,2"/>

                                <StackPanel Orientation="Horizontal" Margin="0,8,0,14">
                                    <Button Style="{StaticResource Btn}"
                                            Content="Clear Override"
                                            Command="{Binding ClearManualCategoryCommand}"
                                            IsEnabled="{Binding Selected.IsManuallyCategorized}"
                                            Width="140"/>
                                </StackPanel>

                                <TextBlock Text="Inferred"
                                           Foreground="{DynamicResource Text3}"
                                           FontSize="10"
                                           Margin="0,0,0,4"/>

                                <TextBlock Text="{Binding Selected.SmartCategory}"
                                           Foreground="{DynamicResource Text0}"
                                           FontSize="11"/>

                                <TextBlock Text="{Binding Selected.SmartConfidence, StringFormat=Confidence: {0:P0}}"
                                           Foreground="{DynamicResource Text2}"
                                           FontSize="10"
                                           Margin="0,0,0,14"/>

                                <TextBlock Text="Metadata"
                                           Foreground="{DynamicResource Text3}"
                                           FontSize="10"
                                           Margin="0,0,0,6"/>

                                <TextBlock Text="{Binding Selected.Meta.DurationSeconds, StringFormat=Duration: {0:0.00}s}"
                                           Foreground="{DynamicResource Text1}" FontSize="10"/>

                                <TextBlock Text="{Binding Selected.Meta.SampleRate, StringFormat=Sample Rate: {0} Hz}"
                                           Foreground="{DynamicResource Text1}" FontSize="10"/>

                                <TextBlock Text="{Binding Selected.Meta.Channels, StringFormat=Channels: {0}}"
                                           Foreground="{DynamicResource Text1}" FontSize="10"/>

                                <TextBlock Text="{Binding Selected.Meta.BitsPerSample, StringFormat=Bit Depth: {0}}"
                                           Foreground="{DynamicResource Text1}" FontSize="10"/>

                                <TextBlock Text="{Binding Selected.Meta.FileSizeBytes, StringFormat=Size: {0:n0} bytes}"
                                           Foreground="{DynamicResource Text1}" FontSize="10"/>

                                <TextBlock Text="{Binding Selected.Meta.LastWriteTime, StringFormat=Modified: {0}}"
                                           Foreground="{DynamicResource Text1}" FontSize="10"/>

                                <TextBlock Text="EFFECTS"
                                           Foreground="{DynamicResource Text3}"
                                           FontSize="9"
                                           FontWeight="SemiBold"
                                           Margin="0,16,0,8"/>

                                <TextBlock Text="Pitch (semitones)"
                                           Foreground="{DynamicResource Text2}"
                                           FontSize="10"
                                           Margin="0,0,0,2"/>
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="40"/>
                                    </Grid.ColumnDefinitions>
                                    <Slider Grid.Column="0"
                                            Minimum="-12" Maximum="12"
                                            Value="{Binding Effects.PitchSemitones}"
                                            TickFrequency="1"
                                            IsSnapToTickEnabled="True"
                                            VerticalAlignment="Center"/>
                                    <TextBlock Grid.Column="1"
                                               Text="{Binding Effects.PitchSemitones, StringFormat={}{0:+0;-0;0}}"
                                               Foreground="{DynamicResource Text1}"
                                               FontSize="10"
                                               VerticalAlignment="Center"
                                               HorizontalAlignment="Right"/>
                                </Grid>

                                <TextBlock Text="Reverb"
                                           Foreground="{DynamicResource Text2}"
                                           FontSize="10"
                                           Margin="0,8,0,2"/>
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="40"/>
                                    </Grid.ColumnDefinitions>
                                    <Slider Grid.Column="0"
                                            Minimum="0" Maximum="1"
                                            Value="{Binding Effects.ReverbMix}"
                                            TickFrequency="0.1"
                                            VerticalAlignment="Center"/>
                                    <TextBlock Grid.Column="1"
                                               Text="{Binding Effects.ReverbMix, StringFormat={}{0:P0}}"
                                               Foreground="{DynamicResource Text1}"
                                               FontSize="10"
                                               VerticalAlignment="Center"
                                               HorizontalAlignment="Right"/>
                                </Grid>

                                <TextBlock Text="Fade In (sec)"
                                           Foreground="{DynamicResource Text2}"
                                           FontSize="10"
                                           Margin="0,8,0,2"/>
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="40"/>
                                    </Grid.ColumnDefinitions>
                                    <Slider Grid.Column="0"
                                            Minimum="0" Maximum="2"
                                            Value="{Binding Effects.FadeInSeconds}"
                                            TickFrequency="0.01"
                                            SmallChange="0.01"
                                            LargeChange="0.1"
                                            VerticalAlignment="Center"/>
                                    <TextBlock Grid.Column="1"
                                               Text="{Binding Effects.FadeInSeconds, StringFormat={}{0:0.00}s}"
                                               Foreground="{DynamicResource Text1}"
                                               FontSize="10"
                                               VerticalAlignment="Center"
                                               HorizontalAlignment="Right"/>
                                </Grid>

                                <TextBlock Text="Fade Out (sec)"
                                           Foreground="{DynamicResource Text2}"
                                           FontSize="10"
                                           Margin="0,8,0,2"/>
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="40"/>
                                    </Grid.ColumnDefinitions>
                                    <Slider Grid.Column="0"
                                            Minimum="0" Maximum="2"
                                            Value="{Binding Effects.FadeOutSeconds}"
                                            TickFrequency="0.01"
                                            SmallChange="0.01"
                                            LargeChange="0.1"
                                            VerticalAlignment="Center"/>
                                    <TextBlock Grid.Column="1"
                                               Text="{Binding Effects.FadeOutSeconds, StringFormat={}{0:0.00}s}"
                                               Foreground="{DynamicResource Text1}"
                                               FontSize="10"
                                               VerticalAlignment="Center"
                                               HorizontalAlignment="Right"/>
                                </Grid>

                                <Button Style="{StaticResource Btn}"
                                        Content="Reset Effects"
                                        Command="{Binding ResetEffectsCommand}"
                                        Margin="0,10,0,0"
                                        Width="140"
                                        HorizontalAlignment="Left"/>
                            </StackPanel>
                        </ScrollViewer>
                    </DockPanel>
                </Border>
            </Grid>
        </DockPanel>

        <!-- ===================== LOADING OVERLAY (ON TOP) ===================== -->
        <Border Background="#CC0F0F10"
                Visibility="{Binding IsLoading, Converter={StaticResource BooleanToVisibilityConverter}}"
                Panel.ZIndex="9999">
            <Grid HorizontalAlignment="Center" VerticalAlignment="Center" Width="520">
                <Border Background="{DynamicResource Bg1}"
                        BorderBrush="{DynamicResource Border}"
                        BorderThickness="1"
                        CornerRadius="6"
                        Padding="18">
                    <StackPanel>
                        <TextBlock Text="RakSound"
                                   Foreground="{DynamicResource Text0}"
                                   FontSize="16"
                                   FontWeight="SemiBold"
                                   Margin="0,0,0,8"/>

                        <TextBlock Text="{Binding LoadingText}"
                                   Foreground="{DynamicResource Text2}"
                                   FontSize="11"
                                   Margin="0,0,0,12"
                                   TextWrapping="Wrap"/>

                        <ProgressBar Height="10"
                                     Minimum="0"
                                     Maximum="1"
                                     Value="{Binding LoadingProgress, Mode=OneWay}"
                                     Background="{DynamicResource WaveBg}"/>

                        <TextBlock Text="{Binding LoadingPercentText}"
                                   Foreground="{DynamicResource Text3}"
                                   FontSize="10"
                                   HorizontalAlignment="Right"
                                   Margin="0,6,0,0"/>
                    </StackPanel>
                </Border>
            </Grid>
        </Border>

    </Grid>
</Window>
